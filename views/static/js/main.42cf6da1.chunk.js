(this.webpackJsonpbillsplit=this.webpackJsonpbillsplit||[]).push([[0],{111:function(e,t,l){},128:function(e,t,l){},129:function(e,t,l){},255:function(e,t,l){"use strict";l.r(t);var s=l(1),r=l(0),n=l.n(r),a=l(112),i=l.n(a),c=(l(128),l(16)),o=(l(129),l(3)),u=l.n(o),d=l(8),p=l(5),h=l(6),b=l(22),m=l(10),j=l(11),f=l(259);function v(e){var t=e.users,l=(e.currentUser,e.selectedUsers),r=e.handleUserSelect;return Object(s.jsx)("div",{children:t.map((function(e){return Object(s.jsx)(s.Fragment,{children:Object(s.jsx)("div",{children:Object(s.jsx)(f.a.Check,{type:"checkbox",value:e,onChange:r,checked:l.includes(e),label:e})},e)})}))})}var O=l(121),g=l(260),x=l(63);function y(e){var t=e.handleAdd,l=e.users,r=e.currentUser,n=e.selectedUsers,a=e.handleUserSelect,i=e.handleSelectAll,c=e.handleSplitType,o=x.b().shape({billName:x.c().required("Required"),billAmt:x.a().required("Required").positive("Amount must be postive.").integer()});return Object(s.jsx)(O.a,{validationSchema:o,onSubmit:function(e){t()},initialValues:{billName:"",billAmt:""},children:function(e){var t=e.handleSubmit,o=e.handleChange,u=e.handleBlur,d=e.values,p=e.touched,h=(e.isValid,e.errors);return Object(s.jsxs)(f.a,{className:"col-sm-2 addBill",autoComplete:"off",onSubmit:t,id:"add-bill",children:[Object(s.jsx)(f.a.Label,{children:"Bill Name"}),Object(s.jsx)(f.a.Control,{className:"billInput",id:"billName",name:"billName",type:"text",onChange:o,onBlur:u,value:d.billName,isValid:p.billName&&!h.billName}),p.billName&&h.billName&&Object(s.jsx)("div",{children:h.billName}),Object(s.jsx)("br",{}),Object(s.jsx)(f.a.Label,{children:"Bill Amount"}),Object(s.jsx)(f.a.Control,{className:"billInput",id:"billAmt",name:"billAmt",type:"text",onChange:o,onBlur:u,value:d.billAmt,isValid:p.billAmt&&!h.billAmt}),p.billAmt&&h.billAmt&&Object(s.jsx)("div",{children:h.billAmt}),Object(s.jsx)("br",{}),Object(s.jsxs)(f.a.Control,{className:"splitType",id:"splitType",onChange:c,as:"select",size:"sm",children:[Object(s.jsx)("option",{children:"Split Bill Amount"}),Object(s.jsx)("option",{children:"Charge Each Amount"})]}),Object(s.jsx)(v,{name:"selectedUsers",id:"selectedUsers",value:d.selectedUsers,users:l,currentUser:r,selectedUsers:n,handleUserSelect:a}),Object(s.jsx)(g.a,{variant:"outline-dark",type:"submit",className:"button",children:"Add"}),Object(s.jsx)(g.a,{variant:"outline-dark",type:"button",onClick:i,className:"button",children:l.length===n.length?"Clear":"Select All"})]})}})}var w=l(23);function B(e){var t,l=e.totalOwedBills,r=e.user,n=l[r]&&l[r].covered?l[r].covered:new Map,a=l[r]&&l[r].owes?l[r].owes:new Map,i=[],o=0,u=Object(w.a)(n.entries());try{for(u.s();!(t=u.n()).done;){var d=Object(c.a)(t.value,2),p=d[0],h=d[1],b=Object(s.jsxs)("div",{style:{backgroundColor:"green"},children:[p," owes you $",h," total"]},o++);i.push(b)}}catch(x){u.e(x)}finally{u.f()}var m,j=Object(w.a)(a.entries());try{for(j.s();!(m=j.n()).done;){var f=Object(c.a)(m.value,2),v=f[0],O=f[1],g=Object(s.jsxs)("div",{style:{backgroundColor:"red"},children:["You owe ",v," $",O," total"]},o++);i.push(g)}}catch(x){j.e(x)}finally{j.f()}return Object(s.jsx)("div",{className:"owedList col-sm-4",children:Object(s.jsx)("ul",{children:i})})}var N=l(258);function A(e){var t=e.owedBills;return Object(s.jsx)("div",{className:"totalSplit col-sm-6",children:Object(s.jsx)(N.a,{className:"splitList",children:t?t.map((function(e,t){return Object(s.jsxs)(N.a.Item,{action:!0,children:[e.billTo," owes ",e.billFrom," : $",e.billAmount," for ",e.billName]},t)})):Object(s.jsx)("br",{})})})}var S=l(30),k=l(14),U=function(){var e=new S.a({id:"billsplit-enxhm"}),t=Object(k.f)();return Object(s.jsx)(g.a,{onClick:function(){return e.currentUser.logOut(),void t.push("/login")},children:"Log Out"})},C=function(){return Object(s.jsx)(U,{})},L=l(26),I=function(){var e=new S.a({id:"billsplit-enxhm"}),t=n.a.useState(e.currentUser),l=Object(c.a)(t,1)[0];return l&&Object(s.jsxs)("div",{className:"profile",children:[Object(s.jsx)("h4",{children:l.name}),Object(s.jsx)("p",{children:l.profile.email}),Object(s.jsx)(C,{}),Object(s.jsx)(L.b,{to:"/",children:Object(s.jsx)(g.a,{type:"button",children:"Home"})})]})},T=(l(237),l(256)),F=l(257),E=l(113),P=l(120),G=l.n(P).a.create({baseURL:"http://localhost:3000/api",headers:{"Content-type":"application/json"}}),M=new(function(){function e(){Object(p.a)(this,e)}return Object(h.a)(e,[{key:"getAll",value:function(e){return G.post("/bill",e)}},{key:"get",value:function(e){return G.get("/bill/".concat(e))}},{key:"create",value:function(e){return G.post("/bill",e)}},{key:"update",value:function(e,t){return G.put("/bill/".concat(e),t)}},{key:"delete",value:function(e){return G.delete("/bill/".concat(e))}},{key:"deleteAll",value:function(){return G.delete("/bill")}}]),e}()),_=(l(111),function(e){Object(m.a)(l,e);var t=Object(j.a)(l);function l(e){var s;return Object(p.a)(this,l),(s=t.call(this,e)).state={selectedUsers:[]},s.handleAdd=s.handleAdd.bind(Object(b.a)(s)),s.handleUserSelect=s.handleUserSelect.bind(Object(b.a)(s)),s.setOwedBills=s.setOwedBills.bind(Object(b.a)(s)),s.handleSelectAll=s.handleSelectAll.bind(Object(b.a)(s)),s.handleSplitType=s.handleSplitType.bind(Object(b.a)(s)),s}return Object(h.a)(l,[{key:"componentDidMount",value:function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setOwedBills(),this.getTotalOwed(),this.getUserList();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getOwedBills",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,l,s,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.props.user.mongoClient("mongodb-atlas"),l=t.db("BillSplit").collection("Bills"),s={$and:[{$or:[{billFrom:this.props.user.profile.email},{billTo:this.props.user.profile.email}]},{groupName:this.props.match.params.groupName}]},e.next=6,l.find(s);case 6:return r=e.sent,e.abrupt("return",r);case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"setOwedBills",value:function(){var e={email:this.props.user.profile.email,groupName:this.props.match.params.groupName};M.getAll(e).then((function(e){console.log("AAAA"+e.data)}))}},{key:"calculateTotalOwedBills",value:function(e,t,l){var s="covered"===l?e.billFrom:e.billTo,r="covered"===l?e.billTo:e.billFrom;if(t.hasOwnProperty(s))if(t[s].hasOwnProperty(l)){var n=t[s][l];if(n.has(r)){var a=n.get(r);a+=parseInt(e.billAmount),n.set(r,a)}else n.set(r,parseInt(e.billAmount))}else{var i=t[s],c="covered"===l?"owes":"covered";if(t[s].hasOwnProperty(c)){var o=t[s][c];if(o.has(r)){var u=o.get(r);if(u-e.billAmount>0)o.set(r,u-e.billAmount);else if(u-e.billAmount<0){var d=new Map;d.set(r,parseInt(e.billAmount)-u),i[l]=d}else o.delete(r)}else{var p=new Map;p.set(r,parseInt(e.billAmount));var h=t[s];h[l]=p,t[s]=h}}else{var b=new Map;b.set(r,parseInt(e.billAmount));var m={};m[l]=b,t[s]=m}}else{var j=new Map;j.set(r,parseInt(e.billAmount));var f={};f[l]=j,t[s]=f}}},{key:"getTotalOwed",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,l,s,r,n,a,i=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.user.mongoClient("mongodb-atlas"),l=t.db("BillSplit").collection("Bills"),s={_partition:"Bill",groupName:this.props.match.params.groupName},e.next=5,l.find(s);case 5:r=e.sent,n=Promise.resolve(Promise.resolve(r)),a={},n.then((function(e){e.forEach((function(e){i.props.user.profile.email===e.billFrom&&i.calculateTotalOwedBills(e,a,"covered"),i.props.user.profile.email===e.billTo&&i.calculateTotalOwedBills(e,a,"owes")})),i.setState({totalOwedBills:a})}));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUserList",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,l,s,r,n=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.user.mongoClient("mongodb-atlas"),l=t.db("BillSplit").collection("Bills"),s={_partition:"group",groupName:this.props.match.params.groupName},e.next=5,l.findOne(s);case 5:r=e.sent,Promise.resolve(Promise.resolve(r)).then((function(e){n.setState({allUsers:e.participants,selectUserList:e.participants})}));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"insertBills",value:function(){var e=Object(d.a)(u.a.mark((function e(t){var l,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{l=this.props.user,s=l.mongoClient("mongodb-atlas"),s.db("BillSplit").collection("Bills").insertMany(t)}catch(r){console.log(r)}case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleAdd",value:function(){var e=this,t=document.getElementById("billName").value,l=document.getElementById("billAmt").value,s=this.state.selectedUsers,r=document.getElementById("splitType").value,n=this.props.user;"Split Bill Amount"===r&&(s.includes(n.profile.email)?(l/=s.length-1,s=s.filter((function(t){return t!==e.props.user.profile.email}))):l/=s.length);for(var a=[],i=this.state.owedBills,c=this.state.totalOwedBills,o=0;o<s.length;o++){var u={billFromId:n.id,billName:t,billTo:s[o],billFrom:this.props.user.profile.email,billAmount:l.toFixed(2),groupName:this.props.match.params.groupName,_partition:"Bill"};this.calculateTotalOwedBills(u,c,"covered"),a.push(u),i.push(u)}this.insertBills(a),this.setState({owedBills:i,totalOwedBills:c}),document.getElementById("add-bill").reset(),this.setState({selectedUsers:[]})}},{key:"handleUserSelect",value:function(e){var t,l=this.state.selectedUsers;e.target.checked?l.push(e.target.value):(t=l.indexOf(e.target.value),l.splice(t,1)),this.setState({selectedUsers:l})}},{key:"handleSelectAll",value:function(){var e=this.state.selectedUsers,t=this.state.selectUserList;t.length===e.length?e=[]:t.filter((function(t){return!e.includes(t)})).map((function(t){return e.push(t)})),this.setState({selectedUsers:e})}},{key:"handleSplitType",value:function(){var e=document.getElementById("splitType").value,t=this.props.user,l=t.profile?t.profile.email:"";if("Charge Each Amount"===e){var s=this.state.selectUserList;s=s.filter((function(e){return e!==l})),this.setState({selectUserList:s})}else{var r=this.state.allUsers;this.setState({selectUserList:r})}}},{key:"render",value:function(){return Object(s.jsxs)(T.a,{fluid:!0,className:"container-fluid",children:[Object(s.jsxs)(F.a,{className:"row",children:[Object(s.jsx)(E.a,{children:Object(s.jsx)("h1",{className:"groupName",children:this.props.match.params.groupName})}),Object(s.jsx)(E.a,{md:"auto",children:Object(s.jsx)(I,{})})]}),Object(s.jsx)("br",{}),Object(s.jsxs)(F.a,{className:"row",children:[Object(s.jsx)(y,{handleAdd:this.handleAdd,users:this.state.selectUserList?this.state.selectUserList:[],currentUser:this.props.user.profile?this.props.user.profile.email:"",selectedUsers:this.state.selectedUsers,handleUserSelect:this.handleUserSelect,handleSelectAll:this.handleSelectAll,handleSplitType:this.handleSplitType}),Object(s.jsx)(A,{className:"col-sm-6",owedBills:this.state.owedBills}),Object(s.jsx)(B,{className:"col-sm-3",totalOwedBills:this.state.totalOwedBills||{},user:this.props.user.profile.email||{}})]})]})}}]),l}(n.a.Component)),$=Object(k.g)(_),q=function(e){Object(m.a)(l,e);var t=Object(j.a)(l);function l(e){var s;return Object(p.a)(this,l),(s=t.call(this,e)).state={groupList:[]},s.getGroupList=s.getGroupList.bind(Object(b.a)(s)),s.handleAddGroup=s.handleAddGroup.bind(Object(b.a)(s)),s}return Object(h.a)(l,[{key:"componentDidMount",value:function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.getGroupList();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getGroupList",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,l,s,r,n=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.user.mongoClient("mongodb-atlas"),l=t.db("BillSplit").collection("Bills"),s={_partition:"userInfo",name:this.props.user.profile.email},e.next=5,l.findOne(s);case 5:r=e.sent,Promise.resolve(Promise.resolve(r)).then((function(e){n.setState({groupList:e.groupList})}));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleAddGroup",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,l,s,r,n,a,i,c,o,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("groupName").value,(l=this.state.groupList).push(t),s=this.props.user.mongoClient("mongodb-atlas"),r=s.db("BillSplit").collection("Bills"),n={_partition:"userInfo",name:this.props.user.profile.email},a={_partition:"userInfo",name:this.props.user.profile.email,groupList:l},i={upsert:!0},e.next=10,r.updateOne(n,a,i);case 10:return c={_partition:"group",groupName:t},o=[this.props.user.profile.email],d={_partition:"group",groupName:t,participants:o},e.next=15,r.updateOne(c,d,i);case 15:this.setState({groupList:l}),document.getElementById("groupForm").reset();case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(s.jsxs)(T.a,{fluid:!0,className:"container-fluid",children:[Object(s.jsxs)(F.a,{children:[Object(s.jsx)(E.a,{children:Object(s.jsx)("h1",{className:"groupName",children:"Bill Split"})}),Object(s.jsx)(E.a,{md:"auto",children:Object(s.jsx)(I,{})})]}),Object(s.jsx)(F.a,{className:"groupList",children:this.state.groupList.map((function(e){return Object(s.jsx)(L.b,{to:"/".concat(e),children:e})}))}),Object(s.jsxs)(f.a,{className:"addGroup",id:"groupForm",inline:!0,children:[Object(s.jsxs)(f.a.Row,{children:[Object(s.jsx)(f.a.Label,{srOnly:!0,children:"New Group"}),Object(s.jsx)(f.a.Control,{id:"groupName",size:"sm",type:"text",placeholder:"New Group"})]}),Object(s.jsx)(g.a,{className:"addButton",variant:"outline-dark",type:"button",onClick:this.handleAddGroup,children:"Add"})]})]})}}]),l}(n.a.Component);function D(e){var t=e.setUser,l=new S.a({id:"billsplit-enxhm"}),r=Object(k.f)();function n(e){var t=document.getElementById("email").value,s=document.getElementById("password").value,n=S.b.emailPassword(t,s);try{e(l.logIn(n)),r.push("/")}catch(a){console.error("Failed log in",a)}}return Object(s.jsxs)("div",{children:[Object(s.jsx)("input",{type:"text",id:"email",placeholder:"Email"}),Object(s.jsx)("br",{}),Object(s.jsx)("input",{type:"text",id:"password",placeholder:"Password",onKeyDown:function(e){13===e.keyCode&&n(t)}}),Object(s.jsx)("br",{}),Object(s.jsx)(g.a,{onClick:function(){n(t)},children:"Log In"})]})}var R=new S.a({id:"billsplit-enxhm"});var V=function(){var e=n.a.useState(R.currentUser),t=Object(c.a)(e,2),l=t[0],r=t[1];return Object(s.jsx)("div",{className:"App",children:Object(s.jsxs)(k.c,{children:[Object(s.jsx)(k.a,{path:"/Login",children:Object(s.jsx)(D,{setUser:r})}),Object(s.jsx)(k.a,{path:"/:groupName",children:Object(s.jsx)($,{user:l})}),Object(s.jsx)(k.a,{path:"/",children:Object(s.jsx)(q,{user:l})})]})})},z=function(e){e&&e instanceof Function&&l.e(3).then(l.bind(null,261)).then((function(t){var l=t.getCLS,s=t.getFID,r=t.getFCP,n=t.getLCP,a=t.getTTFB;l(e),s(e),r(e),n(e),a(e)}))};i.a.render(Object(s.jsx)(L.a,{children:Object(s.jsx)(V,{})}),document.getElementById("root")),z()}},[[255,1,2]]]);
//# sourceMappingURL=main.42cf6da1.chunk.js.map